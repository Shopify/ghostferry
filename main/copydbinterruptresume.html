<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Interrupt and resuming ghostferry-copydb &#8212; Ghostferry 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=712fa57f" />
    <script src="_static/documentation_options.js?v=8d563738"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Verifiers" href="verifiers.html" />
    <link rel="prev" title="Running ghostferry-copydb in production" href="copydbinprod.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="interrupt-and-resuming-ghostferry-copydb">
<span id="copydbinterruptresume"></span><h1>Interrupt and resuming <code class="docutils literal notranslate"><span class="pre">ghostferry-copydb</span></code><a class="headerlink" href="#interrupt-and-resuming-ghostferry-copydb" title="Link to this heading">Â¶</a></h1>
<p><em>Note that this is a new and experimental feature. Please ensure you test it
thoroughly in your environment to ensure there are no data loss. See the bottom
of this page for important information on caveats of using this feature.</em></p>
<p>To enable state dumps of Ghostferry on panic (and thus interrupt &amp; resume), the
configuration given to copydb must have the entry <code class="docutils literal notranslate"><span class="pre">&quot;DumpStateOnSignal&quot;:</span>
<span class="pre">true</span></code>. Once this is configured, any time the process panics, which can be
caused by both SIGTERM/SIGINT or due to an error within Ghostferry, the run
state will be dumped to stdout with JSON. An example of this can be seen below:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;GhostferryVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.1.0+20190311205252+88a1c5c&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;LastKnownTableSchemaCache&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;abc.table1&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;table1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;Collation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;RawType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bigint(20)&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;IsAuto&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;IsUnsigned&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;EnumValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;SetValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;Collation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;utf8mb4_unicode_ci&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;RawType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;varchar(16)&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;IsAuto&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;IsUnsigned&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;EnumValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;SetValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Indexes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PRIMARY&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;Columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;id&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;Cardinality&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;PKColumns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mi">0</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;UnsignedColumns&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;CurrentStage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;COPY&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;CopyStage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;LastProcessedBinlogPosition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mysql-bin.000008&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Pos&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">193989</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;LastSuccessfulPaginationKeys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;abc.table1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;CompletedTables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;VerifierStage&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To resume, you first need to save this JSON into a file. Alternatively, you
could pipe the stdout of <code class="docutils literal notranslate"><span class="pre">ghostferry-copydb</span></code> directly into a file via:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ghostferry-copydb<span class="w"> </span>-verbose<span class="w"> </span>conf.json<span class="w"> </span>&gt;state-dump.json<span class="w"> </span><span class="m">2</span>&gt;ghostferry.log
</pre></div>
</div>
<p>Theoretically, <code class="docutils literal notranslate"><span class="pre">ghostferry-copydb</span></code> should write only the state dump json into
stdout and all logs in stderr. However, check the files to make sure this is
true. If not, file a bug report.</p>
<p>To resume, pass <code class="docutils literal notranslate"><span class="pre">state-dump.json</span></code> as a flag back to <code class="docutils literal notranslate"><span class="pre">ghostferry-copydb</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ghostferry-copydb<span class="w"> </span>-verbose<span class="w"> </span>-resumestate<span class="w"> </span>state-dump.json<span class="w"> </span>conf.json
</pre></div>
</div>
<p><strong>Note: if you interrupt Ghostferry for a period of time longer than your
binlog retention time, you will not be able to resume Ghostferry. Ensure that
the binlog at the position recorded in the state dump is available when
resuming Ghostferry.</strong></p>
<p>Some other considerations/notes:</p>
<ul class="simple">
<li><p>While Ghostferry will dump the state when it encounters an unrecoverable
error (such as a network issue to the databases), the only tested use case
for now is due to an interrupt with SIGTERM/SIGINT.</p>
<ul>
<li><p>Errored runs <em>should</em> be theoretically safe to resume, but this is not
validated in any form.  If you resume an errored run, it is recommended to
validate the correctness of the data using the CHECKSUM TABLE verifier.</p></li>
<li><p>As the project develops, we want to validate the safety of resuming errored
runs.</p></li>
<li><p>To test resuming errored runs further, see <a class="reference internal" href="copydbinprod.html#prodtesting"><span class="std std-ref">Testing Ghostferry with Production Data</span></a>.</p></li>
</ul>
</li>
<li><p>Verifiers are not resumable, including the IterativeVerifier. This may change
in the future.</p></li>
<li><p>While we are confident the algorithm is correct, this is still a
highly experimental feature. USE AT YOUR OWN RISK.</p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Ghostferry</a></h1>



<p class="blurb"> The swiss army knife of live data migrations</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=Shopify&repo=ghostferry&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to Ghostferry</a></li>
<li class="toctree-l1"><a class="reference internal" href="technicaloverview.html">Technical Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorialcopydb.html">Tutorial for ghostferry-copydb</a></li>
<li class="toctree-l1"><a class="reference internal" href="copydbinprod.html">Running <code class="docutils literal notranslate"><span class="pre">ghostferry-copydb</span></code> in production</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Interrupt and resuming <code class="docutils literal notranslate"><span class="pre">ghostferry-copydb</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="verifiers.html">Verifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="howtousecustom.html">Using Ghostferry in Custom Applications</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="copydbinprod.html" title="previous chapter">Running <code class="docutils literal notranslate"><span class="pre">ghostferry-copydb</span></code> in production</a></li>
      <li>Next: <a href="verifiers.html" title="next chapter">Verifiers</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2017-2024, Shopify.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/copydbinterruptresume.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>